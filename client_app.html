
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Timeline Analyzer</title>



    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="js/rdf4j-client.js"></script>
    <script type="text/javascript" src="js/taclient.js"></script>
    <script type="text/javascript" src="js/gui.js"></script>
    <script type="text/javascript" src="js/config.js"></script>
    <script type="text/javascript" src="js/data_functions.js"></script>
    <script type="text/javascript" src="http://visjs.org/dist/vis.js"></script>
    <link href="http://visjs.org/dist/vis-network.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <link rel="stylesheet" type="text/css" href="style/gui.css">

    <script type="text/javascript" src="lib/bootstrap/js/bootstrap.min.js"></script>

</head>
<body>

    <nav id=menu class='navbar navbar-default'>
        <div class=container-fluid>
            <div class=navbar-header>
                <a class='navbar-brand active' href=#>Timeline analyzer</a>
            </div>
            <ul class='nav navbar-nav'>
                <li><a href=main.php>Funkce</a></li>
                <li><a href=zamestnanci.php>Refresh</a></li>
                <li><a onclick="ye()">Návod­</a></li>


            </ul>
        </div>
    </nav>

    <div class=source_class>
        <div class="src">
            <h2>Výběr zdrojů</h2>
            <table class="">
                <tr>
                    <th>
                        <div class="space">
                            <input class='form-control c_box' id="source" list="browsers" name="browser">
                            <datalist id="browsers">
                             
                            </datalist>
                        </div>
                    </th>
                    <th>
                        <div class="space">
                            <input onclick="add()" class='form-control c_box' value='Přidat zdroj' type="submit">
                        </div>
                    </th>

                    <th>
                        <div class="space">
                            <ul class="list-inline" id="adder"></ul>
                        </div>
                    </th>
                </tr>
            </table>

        </div>
    </div>

    <div class=time_class>
        <div class="src">
            <h2>Zadání časového rozsahu</h2>
            <table class="">
                <tr>

                    <th><div class="space"><p id="from"></p></div></th>
                    <th><div class="space"><p id="to"></p></div></th>
                </tr>
                <tr>
                    <th>
                        <div class="space">
                            <input class='form-control c_box' id="startsource" placeholder="Zadejte datum" list="start" name="browser">
                            <datalist id="start"></datalist>

                        </div>
                    </th>
                    <th>
                        <div class="space">
                            <input class='form-control c_box' id="endsource" placeholder="Zadejte datum" list="end" name="browser">
                            <datalist id="end"></datalist>

                        </div>
                    </th>
                    <th>

                        <div class="space">
                            <input onclick="timeadd()" class='form-control c_box' value='Vytvořit rozmezí' type="submit">
                        </div>
                    </th>

                    <th>
                        <div class="space">
                            <ul class="list-inline" id="timeadder"></ul>
                        </div>
                    </th>
                </tr>
            </table>

        </div>
    </div>

    <div class="func_class" id="func">
        <h2>Funkce</h2>
        <table class="my_table">
            <tr>
                <th width="200px">
                    <select id="sel" form="sel" class=form-control>
                        <option value="1">Funkce 1</option>
                        <option value="2">Funkce 2</option>
                        <option value="3">Funkce 3</option>
                    </select>
                </th>
                <th width="200px">
                    <input placeholder='Parametr' class='form-control' name='input' id=para type='text' />
                </th>
                <th width="200px">
                    <input class='form-control' onclick="choser()" form=sel type=submit value='Provést' />
                </th>
            </tr>
        </table>
    </div>


    <!-- Timelines -->
    <div id=med class='jumbotron text-center'>
        <h2>Interaktivní reprezentace dat</h2>
        <div id="ini">
            <input class='form-control' onclick="init()" type=submit value='Inicializovat síť' />
        </div>
    </div>
    <div class="canv_class" id="canv">

    </div>

    <div class="content_class" id="cont">
        <h2>Zobrazení dat prvků</h2>
        <p>Kategorie, které může jednotlivý prvek obsahovat</p>
        <table class="table table-hover">
            <thead>
                <tr>
                    <th>Textová data</th>
                    <th>Fotografie</th>
                    <th>Odkaz na sociální síť</th>
                    <th>Data související se spojeným příspěvkem</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td height="200px"><p id="text_field">Prostor pro zobrazení textových dat.</p></td>
                    <td id="photo_field" height="200px"><img src="img.jpg" alt="" style="width:200px; height:auto;"></td>
                    <td id="url_field" height="200px"><a>https://www.irozhlas.cz/veda-technologie/chytre-chodniky-i-lampy-praha-mohla-byt-smart-city-priklad-si-vezme-z-londyna_1708081944_rez</a></td>
                    <td id="link_field" height="200px">Žádný spojený příspěvek</td>
                </tr>
            </tbody>
        </table>
    </div>




    <script type="text/javascript">



      
        var limit_low;
        var limit_high;
        var times;
        var database_sources = [];
        var startTime;
        var endTime;
        var startDate;
        var endDate;


        TA.DateLimits('ASC').then(function (timelow) {
            limit_low=timelow;
            var pos = timelow.search("T");
            startTime = timelow.substr(0,pos);
            // $("#from").attr("placeholder", timelow.substr(0,pos));
            document.getElementById('from').innerHTML= "Od " + timelow.substr(0,pos);
            document.getElementById('start').innerHTML += '<option value=' + timelow.substr(0,pos)+ '>' ;
            return TA.DateLimits('DESC');
        }).then(function (timehigh) {
            limit_high=timehigh;
            var pos = timehigh.search("T");
            endTime = timehigh.substr(0,pos);
            //  $("#to").attr("placeholder", timehigh.substr(0,pos));
            document.getElementById('to').innerHTML= "Do " + timehigh.substr(0,pos);
            document.getElementById('end').innerHTML += '<option value=' + timehigh.substr(0,pos)+ '>' ;
            return TA.getTimelines();
        }).then(function (timelines) {
            times = timelines;
            console.log(timelines);
            for (var key in timelines) {
                if (timelines.hasOwnProperty(key)) {
                    console.log(key + " -> " + timelines[key].sourceId);
                    document.getElementById('browsers').innerHTML += '<option value=' + timelines[key].sourceId + '>' ;
                    database_sources.push({src: timelines[key].sourceId, URI: timelines[key].URI});
                }
            }

            console.log(limit_low + " rozmezi " + limit_high + " timelines ");
        });

        function timeadd()
        {
            var start = document.getElementById("startsource").value;
            var end = document.getElementById("endsource").value;
            if ( start == '' || end == '')
            {
                alert("Prosím zadejte hodnotu");
                return 0;
            }
            else if (start.length > 10 || end.length > 10)
            {
                alert("Prosím zadejte spravnou hodnotu");
                return 0;
            }
            else
            {
                for(var i = 0; i < start.length; i++)
                {

                    if (i == 4 || i == 7)
                    {
                        if(start[i] != '-'){ alert("Prosím zadejte spravny format");
                            return 0;
                        }
                    }
                    else  if(isNaN(start[i]))
                    {
                        alert("Prosím zadejte spravny format");
                        return 0;
                    }
                }
                for(var i = 0; i < end.length; i++)
                {

                    if (i == 4 || i == 7)
                    {
                        if(end[i] != '-'){ alert("Prosím zadejte spravny format");
                            return 0;
                        }
                    }
                    else  if(isNaN(end[i]))
                    {
                        alert("Prosím zadejte spravny format");
                        return 0;
                    }
                }
                startDate = new Date(start);
                endDate = new Date(end);
              
                TA.setDateSpan(startDate, endDate);

                var compareStart = new Date(startTime);
                var compareEnd = new Date(endTime);
                console.log(startDate.getTime() + " test " + compareStart.getTime() );
                if(startDate.getTime() < compareStart.getTime() || endDate.getTime() > compareEnd.getTime())
                {
                    alert("Prosím zadejte spravnou hodnotu");
                    return 0;
                }

            }

            document.getElementById("startsource").value = '';
            document.getElementById("endsource").value = '';


            startTime = start;
            endTime = end;
            document.getElementById('timeadder').innerHTML = '<li id=' + 1 +'><a class=source_links onclick=deletTime(' +1+') href=#>'  + start +'</li>';
            document.getElementById('timeadder').innerHTML += '<li id=' + 2 +'><a class=source_links onclick=deletTime(' +2+') href=#>'  + end +'</li>';




        }

        function deletTime(id)
        {

            document.getElementById('timeadder').innerHTML = '';

        }

        var color = 'gray';
        var len = undefined;

   
        var nodes =  [];
        var edges =  [];
        var count = 0;
        var sources = [];
        var colors = ['rgb(256,168,7)','rgb(255,100,70)','rgb(200,168,159)','rgb(255,168,7)','rgb(255,168,7)']
        var network;
        var edge_type = '';
        var hide = false;

        sources.push('http://nesfit.github.io/resource/ta#twitter-timeline-DVTVcz');
        sources.push('http://nesfit.github.io/resource/ta#twitter-timeline-iROZHLAScz');
        sources.push('http://nesfit.github.io/resource/ta#twitter-timeline-RESPEKT_CZ');


        const source = 'http://nesfit.github.io/resource/ta#twitter-timeline-DVTVcz';

        var array_of_source_nodes = []; // pole poli s prvky rozdelenych dle zdroju
        var source_structure = [];
        var li_sources = [];
        var promises_array = [];
        var push_promises = [];
        var dates= []; // struktura pro datum
        var date_array = [];
        var object_nodes = [];
        var distanceArray = [];
        var distanceClasses = []; // struktura pro tridy vzdalenosti dle id
        var relations = [];
        var src_date = [];
        var text_data = [];
        var photo_data = [];
        var URL_data = [];
        var link_data = [];
        // source_processing(0);

        var link_struct = []; // data odkazu






        function choser()
        {
            var fnc = document.getElementById("sel").value;
            if (fnc == "1")
                foc();
            else if (fnc == "2")
                funkce2();
            else if (fnc == "3")
                funkce3();
        }

        function funkce2()
        {

        }

        function funkce3()
        {


        }
        var id1 = 0;
        function add()
        {

            var src = document.getElementById("source").value;
            if ( src == '')
            {
                alert("Prosím zadejte hodnotu");
                return 0;
            }


            document.getElementById("source").value = '';
            var check = li_sources.find(check => check.source === src);
            if (check != undefined )
            {
                alert("jiz zadano");
            }
            else
            {
                var test = source_parse(src,0);
                if (test == 0)
                {
                    li_sources.push({id: id1, source: src, content: '<li id=' + id1 +'><a class=source_links onclick=delet(' +id1+') href=#>'  + src +'</li>' });
                    var k = document.getElementById('adder').innerHTML;
                    document.getElementById('adder').innerHTML = k + '<li id=' + id1 +'><a class=source_links onclick=delet(' +id1+') href=#>'  + src +'</li>';
                    id1++;
                }
                else
                {
                    alert("Zadejte platnou hodnotu");
                }



            }

        }
        function source_parse(src,swit)
        {

            for (var i = 0; i < database_sources.length; i++)
            {
                if(database_sources[i].src == src)
                {
                    if(swit==0)
                        source_structure.push(database_sources[i].URI);
                    else
                    {
                        source_structure.splice(source_structure.indexOf(database_sources[i].URI),1);
                    }
                    return 0;
                }
            }
            return 1;

        

        }
        function delet(idf)
        {
            alert(idf);
            var str = "";
            var len = li_sources.length;
            var ck = false;
            var indx = 0;
            for(var i =0; i < len; i++)
            {
                if(idf == li_sources[i].id)
                {
                    console.log(li_sources[i].id);
                    ck=true;
                    indx = i;
                    continue;
                }


                str = str + li_sources[i].content;
            }
            if (ck == true)
            {
                source_parse(li_sources[indx].source,1);
                li_sources.splice(indx,1);

            }

            document.getElementById('adder').innerHTML = str ;

        }

        var lastdate;
        var ar_index=0;
        function foc() {
           
            var datum = document.getElementById("para").value;
            console.log(datum);


     
            var result = cam_node_dates.filter(result => result.date === datum);
            console.log(result);

            if(result === undefined || result.length == 0)
            {
                alert("datum nenalezeno");
            }
            else
            {

                if (datum == lastdate)
                {
                    ar_index++;
                    if(ar_index >= result.length )
                        ar_index=0;
                }
                lastdate=datum;

                var nodeId = result[ar_index].id;
                var options = {
                    // position: {x:positionx,y:positiony}, // this is not relevant when focusing on nodes
                    scale: 1.0,
                    offset: {x:0,y:0},
                    animation: {
                        duration: 1000,
                        easingFunction: 'easeInQuad'
                    }
                };
                // statusUpdateSpan.innerHTML = 'Focusing on node: ' + nodeId;
                // finishMessage = 'Node: ' + nodeId + ' in focus.';
                network.focus(nodeId,options);
            }

        }







        function display_data(id)
        {

            var result = text_data.find(result => result.id === id);
            if(result === undefined)
                document.getElementById('text_field').innerHTML = "Textová data neobsažena";
            else
                document.getElementById('text_field').innerHTML = result.content;

            result = photo_data.filter(res => res.id === id);
            if(result.length > 1)
            {
                document.getElementById('photo_field').innerHTML = '';
                for (var i =0; i < result.length; i++)
                {
                    document.getElementById('photo_field').innerHTML +=   result[i].content + '<br/>'  ;
                }
            }
            else
            {
                result = photo_data.find(result => result.id === id);
                if(result === undefined)
                    document.getElementById('photo_field').innerHTML = "Fotografie neobsažena";
                else
                    document.getElementById('photo_field').innerHTML = result.content;
            }

            result = URL_data.filter(res => res.id === id);
            if(result.length > 1)
            {
                document.getElementById('url_field').innerHTML ='';
                for (var i =0; i < result.length; i++)
                {
                    document.getElementById('url_field').innerHTML += result[i].content + '<br/>'  ;
                }
            }
            else
            {
                result = URL_data.find(result => result.id === id);
                if(result === undefined)
                    document.getElementById('url_field').innerHTML = "URL adresa neobsažena";
                else
                    document.getElementById('url_field').innerHTML = result.content;
            }


            result = link_data.filter(res => res.id === id);
            if(result.length > 1)
            {
                document.getElementById('link_field').innerHTML ='';
                for (var i =0; i < result.length; i++)
                {
                    document.getElementById('link_field').innerHTML +=  result[i].content + '<br/>' ;
                }
            }
            else
            {
                result = link_data.find(result => result.id === id);
                if(result === undefined)
                    document.getElementById('link_field').innerHTML = "Link data neobsažena";
                else
                    document.getElementById('link_field').innerHTML = result.content;
            }


        }

        function ready(){
            network.setOptions( { physics: true } );
        }

        function invoke() {



            var mynetwork = document.getElementById('canv');
            var x = - mynetwork.clientWidth / 2 + 50;
            var y = - mynetwork.clientHeight / 2 + 50;
            var step = 120;

            for (var i =0; i < li_sources.length; i++)
            {
                nodes.push({id: 10000+i, x: 0, y: 0 + (step*i), label: li_sources[i].source, color: colors[i], fixed: true, physics:false});
            }


            /*  for (i = 1; i < count; i++) {
                  edges.push({ from: i, to: 0 });
              }*/

            var container = document.getElementById('canv');
            var data = {
                nodes: nodes,
                edges: edges
            };
            var options = {
                interaction: {
                    navigationButtons: true,
                    keyboard: true,
                    hideEdgesOnDrag: hide
                },

                nodes: {
                    shape: 'dot',
                    size: 30,
                    font: {
                        size: 32,
                        color: '#ffffff'
                    },
                    borderWidth: 2,
                    margin: 10
                },
                physics: false,
                //  "physics": {
                /*  "barnesHut": {
                      "gravitationalConstant": -20000,
                      "centralGravity": 4,
                      "springLength": 40,
                      "springConstant": 1,
                      "damping": 0.7,
                      "avoidOverlap": 0.79
                  },
                  "minVelocity": 0.75*/
                /*   forceAtlas2Based: {
                       gravitationalConstant: -26,
                       centralGravity: 0.005,
                       springLength: 230,
                       springConstant: 0.18
                   },
                   maxVelocity: 146,
                   solver: 'forceAtlas2Based',
                   timestep: 0.35,
                   stabilization: {iterations: 150},*/
                //  },
                // layout:{randomSeed:2},

                edges: {
                    // width: 2
                    smooth:{type:edge_type},



                }
            };
            network = new vis.Network(container, data, options);
            network.moveTo({
                position: {x: 0, y: 0},
                offset: {x: -500, y: -150},
                scale: 1,
            });

            network.on("click", function (params) {
                params.event = "[original event]";
                console.log('click event, getNodeAt returns: ' + this.getNodeAt(params.pointer.DOM));
                display_data(this.getNodeAt(params.pointer.DOM));
            });


        }


    </script>
</body>
</html>
